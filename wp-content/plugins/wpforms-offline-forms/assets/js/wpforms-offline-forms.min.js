"use strict";var WPFormsOfflineForms=window.WPFormsOfflineForms||function(i,e,s){var o={isOffline:!1,forms:[],formsData:{},storage:{local:store.namespace("wpforms").namespace("offline"),expire:86400,set:function(e,t){e=this.local.namespace(parseInt(e,10));e.set(e.size()+1,t,this.expire)},get:function(e){e=parseInt(e,10);var t=this.getAll(e),i={};return 0<t.length&&(i=t.shift()),this.local.namespace(e).remove(i.entry_id),i},getAll:function(e){var t,i=this.local.namespace(parseInt(e,10)).getAll(),o=[];for(t in i)i.hasOwnProperty(t)&&!s.isEmptyObject(i[t])&&o.push({entry_id:t,entry:i[t]});return o},clearAll:function(e){this.local.namespace(parseInt(e,10)).clearAll()}},notifications:{$_form:!1,_actions:[],setForm:function(e){return this.$_form=e,this._clearActions(),this},setActions:function(e){if(!e)return this._clearActions(),this;for(var t in e)e.hasOwnProperty(t)&&this._actions.push({key:t,label:e[t]});return this},_clearActions:function(){this._actions=[]},_getNotificationTemplate:function(){return s('<div class="wpforms-notice wpforms-info"></div>')},_getActionsTemplate:function(){return s('<div class="wpforms-notice-actions"></div>')},_getActionTemplate:function(){return s('<a class="wpforms-notice-action"></a>')},display:function(e,t){var i="non-dismissible";t&&(i="");e=this._getNotificationTemplate().addClass(i).html(e);if(this._actions.length){var o,n=this._getActionsTemplate();for(o in this._actions)n.append(this._getActionTemplate().attr("href","#"+encodeURIComponent(this._actions[o].key)).text(this._actions[o].label));e.append(n)}s(".wpforms-field-container",this.$_form).before(e);e=this.$_form;s("html, body").animate({scrollTop:e.offset().top-100},750)},hide:function(){s(".wpforms-notice",this.$_form).not(".non-dismissible").remove()},hideAll:function(){s(".wpforms-notice",this.$_form).remove()}},init:function(){o.populateForms(),e.addEventListener("online",o.connectionEvent),e.addEventListener("offline",o.connectionEvent),s(i).on("wpformsReady",o.checkConnectivityLoop),s(i).on("wpformsReady",o.checkOfflineRecords),s(i).on("wpformsReady",o.saveFormDefaults),o.bindUIActions()},populateForms:function(){s.each(wpforms_offline_forms.offline_form_ids,function(e,t){o.forms.push(s("#wpforms-"+t))})},checkConnectivityLoop:function(){var e=parseInt(wpforms_offline_forms.check_connection_interval,10);o._isNaturalNumber(e)&&setInterval(function(){o.processConnectivityAjaxCheck(null)},1e3*e)},processConnectivityAjaxCheck:function(i){var e=parseInt(wpforms_offline_forms.check_connection_timeout,10);o._isNaturalNumber(e)&&s.ajax({method:"HEAD",url:wpforms_offline_forms.check_connection_url,cache:!1,timeout:1e3*e,complete:function(e,t){0!==e.status&&"timeout"!==t?(o.isOffline=!1,o.notificationOfflineHide()):(o.isOffline=!0,o.notificationOfflineDisplay()),"function"==typeof i&&i()}})},checkOfflineRecords:function(){s.each(o.forms,function(e,t){var i=o.storage.getAll(t.find("form").data("formid")),t=o.notifications.setForm(t);t.hideAll(),0!==i.length&&(1===i.length?(o.isOffline||t.setActions({offline_restore:wpforms_offline_forms.text_restore_btn,offline_clear:wpforms_offline_forms.text_clear_btn}),t.display(wpforms_offline_forms.text_restore_single)):(o.isOffline||t.setActions({offline_restore:wpforms_offline_forms.text_restore_btn,offline_clear:wpforms_offline_forms.text_clear_all_btn}),t.display(wpforms_offline_forms.text_restore_plural)))})},saveFormDefaults:function(){s.each(wpforms_offline_forms.offline_form_ids,function(e,t){o.formsData[t]=s("#wpforms-"+t).find("form").serializeArray()})},processRestoreFormDefault:function(e){var t,i=s("#wpforms-"+e);void 0!==o.formsData[e]&&i.length&&(i.find("form").deserialize(o.formsData[e],{change:o.deserializeChangeCallback}),i.find(".wpforms-page-indicator").length&&(i.find('.wpforms-page-prev[data-page="2"]').length?(i.find(".wpforms-page").hide(),i.find('.wpforms-page-prev[data-page="2"]').trigger("click")):((t=s('<button class="wpforms-page-button wpforms-page-prev"></button>')).css("visibility","hidden").data("action","prev").data("page","2").data("formid",e),i.find(".wpforms-page").hide(),i.find(".wpforms-field-pagebreak").first().append(t),t.trigger("click"),t.remove())),0<(i=i.find(".wpforms-field-select-style-modern")).length&&i.each(function(){var e=s(this).find(".choicesjs-select"),t=e.data("choicesjs");t.destroy(),t.init(),s(this).hasClass("wpforms-conditional-trigger")&&e.trigger("change")}),this.checkOfflineRecords())},deserializeChangeCallback:function(e){var t=s(this),i=t.closest(".wpforms-field");!i.hasClass("wpforms-field-phone")||void 0===s.fn.intlTelInput||0<(i=i.find(".wpforms-smart-phone-field")).length&&i.intlTelInput("setNumber",e),t.trigger("change")},setModernDropdownFields:function(o,n){o.find(".choicesjs-select").each(function(){var t=s(this).attr("name"),i=s(this).data("choicesjs"),e=i.getValue(!0);e.length&&i.removeActiveItems(e),n.forEach(function(e){e.name===t&&i.setChoiceByValue(e.value)}),o.hasClass("wpforms-conditional-trigger")&&s(this).trigger("change")})},bindUIActions:function(){var n=this;s.each(o.forms,function(e,t){n.processFormSave(t.find("form"))}),s.each(o.forms,function(e,t){s(i).on("click","#"+t.attr("id")+' .wpforms-submit-container button[type="submit"]',function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=s(this),e=t.data("alt-text"),i=s(this).closest("form"),o=t.text();t.prop("disabled")||(t.prop("disabled",!0),e&&t.text(e),n.processConnectivityAjaxCheck(function(){t.prop("disabled",!1),t.text(o),i.submit()}))})}),s(i).on("click",'.wpforms-notice-action[href="#offline_restore"]',function(e){e.preventDefault(),n.processRestore(s(this).closest("form"))}),s(i).on("click",'.wpforms-notice-action[href="#offline_clear"]',function(e){e.preventDefault(),n.processClearAll(s(this).closest("form"))})},processFormSave:function(i){i.submit(function(e){if(!o.isOffline)return!0;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=parseInt(i.data("formid"),10);s(".wpforms-field",i).each(function(e,t){(s(t).hasClass("wpforms-field-password")||s(t).hasClass("wpforms-field-credit-card")||s(t).hasClass("wpforms-field-signature"))&&s(t).find("input, select").attr("disabled","disabled")});e=i.serializeArray();s(".wpforms-field",i).each(function(e,t){(s(t).hasClass("wpforms-field-password")||s(t).hasClass("wpforms-field-credit-card")||s(t).hasClass("wpforms-field-signature"))&&s(t).find("input, select").prop("disabled",!1)}),o.storage.set(t,e),o.processRestoreFormDefault(t)})},processRestore:function(e){var t=this.storage.get(e.data("formid"));e.deserialize(t.entry,{change:o.deserializeChangeCallback});e=e.find(".wpforms-field-select-style-modern");0<e.length&&o.setModernDropdownFields(e,t.entry),this.checkOfflineRecords()},processClearAll:function(e){this.storage.clearAll(e.data("formid")),this.notifications.setForm(e).hideAll()},connectionEvent:function(){o.connectionUpdateStatus()},connectionUpdateStatus:function(){void 0!==navigator.onLine&&(o.isOffline=!navigator.onLine,s("body").toggleClass("wpforms-is-offline",o.isOffline),o.isOffline?o.notificationOfflineDisplay():o.notificationOfflineHide())},notificationOfflineDisplay:function(){s.each(o.forms,function(e,t){t=o.notifications.setForm(t);t.hideAll(),t.display(wpforms_offline_forms.text_offline,!0)})},notificationOfflineHide:function(e){this.notifications.setForm(e).hide(),this.checkOfflineRecords()},_isNaturalNumber:function(e){return 0<=e&&Math.floor(e)===+e}};return o}(document,window,jQuery);WPFormsOfflineForms.init();